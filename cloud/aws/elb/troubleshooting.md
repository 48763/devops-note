# ELB 錯誤排查

這裡的問題不一定有解，但會有一些相關的資訊。

- 負載均衡器不導流至非健康的目標群集
- 全站加速器是否會判斷負載均衡器 IP 可用
- 應用層負載均衡器僅有一個 IP

## 負載均衡器不導流至非健康的目標群集

### 問題

負載均衡器的監聽器有多個目標群組（target group），其中一個目標群組內的機器/目標全部評估為 `unhealthy`，這時有什麼方式能在不調整權重，但能讓 ELB 導流至其它目標群組呢？

### 回答

負載均衡器在接收流量時，僅按照權重（weight）分配流量給目標群組，之後才會按照群組內的設定和狀況，分配流量給機器/目標。例如：
- 群組內有多個機器/目標，最少有一個為健康，則流量會依照負載均衡算法，僅分配給健康的機器/目標。
- 群組內所有的機器/目標，都不為健康，則流量將會依照負載均衡算法分配。


## 全站加速器是否會判斷負載均衡器 IP 可用

### 問題

負載均衡器在其中一個子網域的路由表並沒有設置網路閘道（internet gateways）的路由，這時在該負載均衡器啟用（創建）全站加速器（global accelerator），它是否會判斷負載均衡器的 IP 是否可連線，來進行連線的路由繞送？

### 回答

全站加速器會將流量分散至每個所配置的可用/健康端點（不包含目標群組的機器/目標）。

## 應用層負載均衡器僅有一個 IP

### 問題

為什麼應用負載均衡器的 DNS 僅解析出 1個 IP？
> 補充：只選了 2個可用區（subnet）。而解析出的 IP，為有放置節點的區域，另一個則沒有。

### 回答

- 可用區內沒有任何應用節點。 
- 節點的安全組沒有允許另一個可用區的網段。

> 僅測試變成成 1個 IP。設定完，並不會馬上有效過，大約經過一週。


### 實際上

在我手邊的環境，是有存在一個應用負載均衡器選擇 3個可用區，但只有放 1個節點，並且安全組只放行該自己和負載均衡器的安全組，但解析出來的 IP 卻有 2個。這時還發現，雖然官方文件寫說選擇幾個可用區，就會有相等數量的 IP，但實際有出入。
